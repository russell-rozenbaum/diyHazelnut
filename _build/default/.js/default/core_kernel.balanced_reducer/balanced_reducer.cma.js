// Generated by js_of_ocaml
//# buildInfo:effects=false, kind=cma, use-js-string=true, version=5.8.1+5.8.1

//# unitInfo: Provides: Balanced_reducer
//# unitInfo: Requires: Assert_failure, Base, Base__Int, Base__List, Base__Option_array, Expect_test_collector, Ppx_bench_lib__Benchmark_accumulator, Ppx_inline_test_lib__Runtime, Ppx_module_timer_runtime, Sexplib0__Sexp_conv
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Balanced_reducer = "Balanced_reducer",
    cst_balanced_reducer = "balanced_reducer",
    cst_balanced_reducer_src_balan =
      "balanced_reducer/src/balanced_reducer.ml",
    cst_index = "index",
    caml_maybe_attach_backtrace = runtime.caml_maybe_attach_backtrace;
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   function caml_call3(f, a0, a1, a2){
    return (f.l >= 0 ? f.l : f.l = f.length) == 3
            ? f(a0, a1, a2)
            : runtime.caml_call_gen(f, [a0, a1, a2]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    cst = "",
    Base_Option_array = global_data.Base__Option_array,
    Sexplib0_Sexp_conv = global_data.Sexplib0__Sexp_conv,
    Base = global_data.Base,
    Base_Int = global_data.Base__Int,
    Assert_failure = global_data.Assert_failure,
    Base_List = global_data.Base__List,
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Expect_test_collector = global_data.Expect_test_collector,
    Ppx_inline_test_lib_Runtime = global_data.Ppx_inline_test_lib__Runtime;
   caml_call1(Ppx_module_timer_runtime[4], cst_Balanced_reducer);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][1], cst_balanced_reducer);
   caml_call1(Expect_test_collector[5][1], cst_balanced_reducer_src_balan);
   caml_call2(Ppx_inline_test_lib_Runtime[2], cst_balanced_reducer, cst);
   var
    _a_ = [0, cst_balanced_reducer_src_balan, 76, 9],
    _b_ = [0, cst_balanced_reducer_src_balan, 78, 6],
    _c_ = [0, "num_leaves"],
    cst_non_positive_number_of_lea =
      "non-positive number of leaves in balanced reducer",
    _d_ = [0, "_"],
    _e_ = [0, cst_index],
    cst_attempt_to_access_negative =
      "attempt to access negative index in balanced reducer",
    _f_ = [0, "length"],
    _g_ = [0, cst_index],
    cst_attempt_to_access_out_of_b =
      "attempt to access out of bounds index in balanced reducer",
    _i_ = [0, cst_balanced_reducer],
    cst_attempt_to_compute_balance =
      "attempt to compute balanced reducer with unset elements";
   function left_child_index(parent_index){return (parent_index * 2 | 0) + 1 | 0;
   }
   function num_branches(t){return t[2] - 1 | 0;}
   function index_is_leaf(t, i){return num_branches(t) <= i ? 1 : 0;}
   function leaf_index(t, i){
    var
     offset_from_start_of_leaves_in = i + t[3] | 0,
     rotated_index =
       offset_from_start_of_leaves_in < t[2]
        ? offset_from_start_of_leaves_in
        : offset_from_start_of_leaves_in - t[2] | 0;
    return rotated_index + num_branches(t) | 0;
   }
   function sexp_of_t(sexp_of_a, t){
    var
     x_001 =
       caml_call2
        (Base_List[123],
         t[2],
         function(i){
          var _D_ = leaf_index(t, i);
          return caml_call2(Base_Option_array[33], t[1], _D_);
         }),
     _C_ = caml_call1(Base[152], sexp_of_a);
    return caml_call2(Base[139], _C_, x_001);
   }
   function invariant(invariant_a, t){
    var
     data = t[1],
     _x_ = caml_call1(Base_Option_array[6], data) - 1 | 0,
     _w_ = 0;
    if(_x_ >= 0){
     var i$0 = _w_;
     for(;;){
      var match = caml_call2(Base_Option_array[33], data, i$0);
      if(match){var a = match[1]; caml_call1(invariant_a, a);}
      var _B_ = i$0 + 1 | 0;
      if(_x_ === i$0) break;
      i$0 = _B_;
     }
    }
    var _z_ = num_branches(t) - 1 | 0, _y_ = 0;
    if(_z_ >= 0){
     var i = _y_;
     for(;;){
      var
       left_child_index$0 = left_child_index(i),
       right = left_child_index$0 + 1 | 0,
       left_is_none =
         caml_call2(Base_Option_array[35], data, left_child_index$0),
       right_is_none = caml_call2(Base_Option_array[35], data, right);
      a:
      {
       if(caml_call2(Base_Option_array[36], data, i)){
        if(! left_is_none && ! right_is_none) break a;
        throw caml_maybe_attach_backtrace([0, Assert_failure, _a_], 1);
       }
       if
        (!
         index_is_leaf(t, left_child_index$0)
         && ! index_is_leaf(t, right) && ! left_is_none && ! right_is_none)
        throw caml_maybe_attach_backtrace([0, Assert_failure, _b_], 1);
      }
      var _A_ = i + 1 | 0;
      if(_z_ === i) break;
      i = _A_;
     }
    }
    return 0;
   }
   function create_exn(opt, param, num_leaves, reduce){
    if(opt)
     var sth = opt[1], sexp_of_a = sth;
    else
     var sexp_of_a = function(param){return _d_;};
    if(num_leaves < 1){
     var
      _u_ = [0, [1, [0, _c_, [0, caml_call1(Base[119], num_leaves), 0]]], 0],
      _v_ =
        [1,
         [0,
          caml_call1(Sexplib0_Sexp_conv[7], cst_non_positive_number_of_lea),
          _u_]];
     caml_call1(Base[202], _v_);
    }
    var
     num_branches = num_leaves - 1 | 0,
     num_leaves_not_in_bottom_level =
       caml_call1(Base_Int[63], num_leaves) - num_leaves | 0,
     data = caml_call1(Base_Option_array[5], num_branches + num_leaves | 0);
    return [0,
            data,
            num_leaves,
            num_leaves_not_in_bottom_level,
            reduce,
            sexp_of_a];
   }
   function validate_index(t, i){
    if(i < 0){
     var
      _o_ = [0, [1, [0, _e_, [0, caml_call1(Base[119], i), 0]]], 0],
      _p_ =
        [1,
         [0,
          caml_call1(Sexplib0_Sexp_conv[7], cst_attempt_to_access_negative),
          _o_]];
     caml_call1(Base[202], _p_);
    }
    var length = t[2], _q_ = length <= i ? 1 : 0;
    if(! _q_) return _q_;
    var
     _r_ = [0, [1, [0, _f_, [0, caml_call1(Base[119], length), 0]]], 0],
     _s_ = [0, [1, [0, _g_, [0, caml_call1(Base[119], i), 0]]], _r_],
     _t_ =
       [1,
        [0,
         caml_call1(Sexplib0_Sexp_conv[7], cst_attempt_to_access_out_of_b),
         _s_]];
    return caml_call1(Base[202], _t_);
   }
   function set_exn(t, i, a){
    validate_index(t, i);
    var data = t[1], i$0 = [0, leaf_index(t, i)];
    caml_call3(Base_Option_array[42], data, i$0[1], a);
    for(;;){
     if(0 === i$0[1]) return 0;
     var child_index = i$0[1], parent = (child_index - 1 | 0) / 2 | 0;
     if(caml_call2(Base_Option_array[35], data, parent))
      i$0[1] = 0;
     else{caml_call2(Base_Option_array[50], data, parent); i$0[1] = parent;}
    }
   }
   function get_exn(t, i){
    validate_index(t, i);
    var _n_ = leaf_index(t, i);
    return caml_call2(Base_Option_array[34], t[1], _n_);
   }
   function _h_(x_002, i){
    if(caml_call2(Base_Option_array[36], x_002[1], i))
     return caml_call2(Base_Option_array[38], x_002[1], i);
    var
     left_child_index$0 = left_child_index(i),
     right = left_child_index$0 + 1 | 0;
    if(caml_call1(Base_Option_array[6], x_002[1]) <= left_child_index$0){
     var
      sexp_of_a = x_002[5],
      _j_ = [0, [1, [0, _i_, [0, sexp_of_t(sexp_of_a, x_002), 0]]], 0],
      _k_ =
        [1,
         [0,
          caml_call1(Sexplib0_Sexp_conv[7], cst_attempt_to_compute_balance),
          _j_]];
     caml_call1(Base[202], _k_);
    }
    var
     _l_ = _h_(x_002, right),
     _m_ = _h_(x_002, left_child_index$0),
     a = caml_call2(x_002[4], _m_, _l_);
    caml_call3(Base_Option_array[49], x_002[1], i, a);
    return a;
   }
   function compute_exn(t){return _h_(t, 0);}
   caml_call1(Ppx_inline_test_lib_Runtime[3], cst_balanced_reducer);
   caml_call1(Expect_test_collector[5][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Balanced_reducer);
   var
    Balanced_reducer =
      [0, sexp_of_t, invariant, create_exn, set_exn, get_exn, compute_exn];
   runtime.caml_register_global(29, Balanced_reducer, cst_Balanced_reducer);
   return;
  }
  (globalThis));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLjAsImZpbGUiOiJiYWxhbmNlZF9yZWR1Y2VyLmNtYS5qcyIsInNvdXJjZVJvb3QiOiIiLCJuYW1lcyI6WyJsZWZ0X2NoaWxkX2luZGV4IiwicGFyZW50X2luZGV4IiwibnVtX2JyYW5jaGVzIiwidCIsImluZGV4X2lzX2xlYWYiLCJpIiwibGVhZl9pbmRleCIsIm9mZnNldF9mcm9tX3N0YXJ0X29mX2xlYXZlc19pbiIsInJvdGF0ZWRfaW5kZXgiLCJzZXhwX29mX3QiLCJzZXhwX29mX2EiLCJ4XzAwMSIsImludmFyaWFudCIsImludmFyaWFudF9hIiwiZGF0YSIsImkkMCIsImEiLCJsZWZ0X2NoaWxkX2luZGV4JDAiLCJyaWdodCIsImxlZnRfaXNfbm9uZSIsInJpZ2h0X2lzX25vbmUiLCJjcmVhdGVfZXhuIiwib3B0IiwibnVtX2xlYXZlcyIsInJlZHVjZSIsInN0aCIsIm51bV9sZWF2ZXNfbm90X2luX2JvdHRvbV9sZXZlbCIsInZhbGlkYXRlX2luZGV4IiwibGVuZ3RoIiwic2V0X2V4biIsImNoaWxkX2luZGV4IiwicGFyZW50IiwiZ2V0X2V4biIsInhfMDAyIiwiY29tcHV0ZV9leG4iXSwic291cmNlcyI6WyIvVXNlcnMvcnVzc2VsbHJvemVuYmF1bS8ub3BhbS9kaXktaGF6ZWxudXQvbGliL2NvcmVfa2VybmVsL2JhbGFuY2VkX3JlZHVjZXIvYmFsYW5jZWRfcmVkdWNlci5tbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztHOzs7OztHOzs7OztHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1lBbUNJQSxpQkFBa0JDLGNBQWUsUUFBZkE7R0FBcUM7WUFLdkRDLGFBQWFDLEdBQUksT0FBSkEsYUFBb0I7WUFDakNDLGNBQWNELEdBQUVFLEdBQUksT0FEcEJILGFBQ2NDLE1BQUVFLFVBQXVCO1lBSXZDQyxXQUFXSCxHQUFFRTtJQUdmO0tBQ01FLGlDQUpTRixJQUFGRjtLQUdUSztPQUNFRCxpQ0FKT0o7VUFJUEk7VUFBQUEsaUNBSk9KO1dBR1RLLGdCQVJGTixhQUtXQztHQVVpQjtZQUs1Qk0sVUFBVUMsV0FBVVA7SUFEZ0I7S0FDUVE7T0FEUjs7U0FDaEJSO2tCQURxQkU7VUFERixVQWJ2Q0MsV0Flb0JILEdBRHFCRTtVQURGLE9BQUEsa0NBRW5CRjtTQURzQztpQ0FDaERPO3NDQUFrQ0M7O1lBRTVDQyxVQUFVQyxhQUFZVjtJQUN4QjtLQUFJVyxPQURvQlg7S0FFWCxNQUFBLGlDQURUVzs7O1NBQ0pDOztNQUNRLFlBQUEsa0NBRkpELE1BQ0pDO29CQUdTQyxjQUFLLFdBTEZILGFBS0hHO01BSFQsVUFBQUQ7aUJBQUFBO01BQUFBOzs7SUFLYSxJQUFBLE1BN0JYYixhQXNCc0JDLFlBT3hCOztTQUFBRTs7TUFDYTtPQWxDUVkscUJBRG5CakIsaUJBa0NGSztPQUVNYSxRQW5DZUQ7T0FvQ2ZFO1NBQWUsa0NBVGpCTCxNQTNCaUJHO09BcUNmRyxnQkFBZ0Isa0NBVmxCTixNQVFFSTs7O09BR0QsR0FBQSxrQ0FYREosTUFNSlQ7UUFJc0IsS0FEaEJjLGtCQUNBQztRQUVDLE1BQUE7Ozs7U0FsQ0xoQixjQXFCc0JELEdBMUJIYztjQUtuQmIsY0FxQnNCRCxHQVNsQmUsWUFDQUMsa0JBQ0FDO1FBSUYsTUFBQTs7TUFSSixVQUFBZjtpQkFBQUE7TUFBQUE7Ozs7R0FVSTtZQUdGZ0IsV0FBYUMsWUFBbUNDLFlBQVlDO0lBQzlELEdBRGVGO1NBQXVCRyxNQUF2QkgsUUFBQVosWUFBdUJlOztTQUF2QmYsNEI7T0FBbUNhOzt1REFBQUE7Ozs7OztLQUdoRDs7SUFBQTtLQUVFckIsZUFMOENxQjtLQU05Q0c7T0FBaUMseUJBTmFILGNBQUFBO0tBTzlDVCxPQUFPLGlDQUZQWixlQUw4Q3FCO0lBUWxEO1lBRElUO1lBUDhDUztZQU05Q0c7WUFOMERGO1lBQS9DZDtHQVF3RDtZQUdyRWlCLGVBQWV4QixHQUFFRTtJQUNuQixHQURtQkE7O3VEQUFBQTs7Ozs7O0tBR2pCOztRQUVFdUIsU0FMYXpCLFlBS2J5QixVQUxldkI7OztzREFLZnVCO3NEQUxldkI7Ozs7Ozs7R0FZSTtZQUdyQndCLFFBQVExQixHQUFFRSxHQUFFVztJQWZaVyxlQWVReEIsR0FBRUU7SUFHSixJQURKUyxPQUZNWCxNQUdOWSxVQWxFRlQsV0ErRFFILEdBQUVFO0lBSVosa0NBRklTLE1BQ0FDLFFBSFVDOztjQUdWRDtTQTdFWWUsY0E2RVpmLFFBR0VnQixVQWhGVUQ7S0FpRlgsR0FBQSxrQ0FMRGhCLE1BSUVpQjtNQUhGaEI7VUFPQSxrQ0FSQUQsTUFJRWlCLFNBSEZoQixTQUdFZ0I7O0dBTUY7WUFHRkMsUUFBUTdCLEdBQUVFO0lBOUJWc0IsZUE4QlF4QixHQUFFRTtJQUVxQixVQWhGL0JDLFdBOEVRSCxHQUFFRTtJQUVxQixPQUFBLGtDQUZ2QkY7R0FFdUM7Z0JBRy9COEIsT0FBRTVCO0lBQ3BCLEdBQUcsa0NBRGU0QixVQUFFNUI7S0FFZixPQUFBLGtDQUZhNEIsVUFBRTVCO0lBSVA7S0FoR1FZLHFCQURuQmpCLGlCQTZGa0JLO0tBS2RhLFFBakdlRDtPQWtHUixpQ0FOS2dCLGFBNUZHaEI7O01BcUdiUCxZQVRVdUI7aUNBcEVoQnhCLFVBNkVNQyxXQVRVdUI7Ozs7OztLQVVkOztJQUlvQztLQUFBLFVBZHRCQSxPQUtaZjtLQVNhLFVBZERlLE9BNUZHaEI7S0EwR2ZELElBQUksV0FkUWlCO0lBZWhCLGtDQWZnQkEsVUFBRTVCLEdBY2RXO0lBQ0osT0FESUE7R0FFRjtZQUdGa0IsWUFBWS9CLEdBQUksV0FBSkEsTUFBbUI7Ozs7Ozs7VUF2Ri9CTSxXQUVBRyxXQW9CQVMsWUEwQkFRLFNBZUFHLFNBd0JBRTs7O0UiLCJzb3VyY2VzQ29udGVudCI6WyJvcGVuISBCYXNlXG5cbigqIFRoZSBbZGF0YV0gYXJyYXkgaXMgYW4gaW1wbGljaXQgYmluYXJ5IHRyZWUgd2l0aCBbY2hpbGRyZW5fbGVuZ3RoICogMiAtIDFdIG5vZGVzLFxuICAgd2l0aCBlYWNoIG5vZGUgYmVpbmcgdGhlIHN1bSBvZiB0aGUgdHdvIGNoaWxkIG5vZGVzIGFuZCB0aGUgcm9vdCBub2RlIGJlaW5nIHRoZSAwdGhcbiAgIG5vZGUuICBUaGUgbGVhdmVzIG9mIHRoZSB0cmVlIGFyZSB0aGUgbGFzdCBbbnVtX2xlYXZlc10gbm9kZXMuXG5cbiAgIFRoZSBjaGlsZHJlbiBhcmUgbm90IG5lY2Vzc2FyaWx5IGFsbCBhdCB0aGUgc2FtZSBsZXZlbCBvZiB0aGUgdHJlZS4gRm9yIGluc3RhbmNlIGlmXG4gICB5b3UgaGF2ZSAzIGNoaWxkcmVuIFt8IGE7IGI7IGMgfF06XG5cbiAgIHt2XG4gICAgICAgICAgb1xuICAgICAgICAgLyBcXFxuICAgICAgICBvICAgY1xuICAgICAgIC8gXFxcbiAgICAgIGEgICBiXG4gICB2fVxuXG4gICBXZSB3YW50IHRoaXMgdHJlZSB0byBiZSByZXByZXNlbnRhdGVkIGFzIFt8IG87IG87IGM7IGE7IGIgfF0sIGkuZS4gd2UgbmVlZCB0byBhcHBseVxuICAgZmlyc3QgYSByb3RhdGlvbiB0aGVuIGEgdHJhbnNsYXRpb24gdG8gY29udmVydCBhbiBpbmRleCBpbiBbfCBhOyBiOyBjIHxdIHRvIGEgKGxlYWYpXG4gICBpbmRleCBpbiBbfCBvOyBvOyBjOyBhOyBiIHxdLiAqKVxudHlwZSAnYSB0ID1cbiAgeyBkYXRhIDogJ2EgT3B0aW9uX2FycmF5LnRcbiAgOyBudW1fbGVhdmVzIDogaW50XG4gIDsgbnVtX2xlYXZlc19ub3RfaW5fYm90dG9tX2xldmVsIDogaW50XG4gIDsgcmVkdWNlIDogJ2EgLT4gJ2EgLT4gJ2FcbiAgOyBzZXhwX29mX2EgOiAnYSAtPiBTZXhwLnRcbiAgfVxuXG5sZXQgbGVuZ3RoIHQgPSB0Lm51bV9sZWF2ZXNcblxuKCoge3ZcbiAgICAgcGFyZW50OiAgICAgIDAgIDEgIDIgIDMgIDQgIDUgIDYgIDcgIDggIDkgMTAgMTEgMTIgMTMgMTQgMTUgMTYgMTcgMTggMTkgLi4uXG4gICAgIGxlZnQgY2hpbGQ6ICAxICAzICA1ICA3ICA5IDExIDEzIDE1IDE3IDE5IDIxIDIzIDI1IDI3IDI5IDMxIDMzIDM1IDM3IDM5IC4uLlxuICAgICByaWdodCBjaGlsZDogMiAgNCAgNiAgOCAxMCAxMiAxNCAxNiAxOCAyMCAyMiAyNCAyNiAyOCAzMCAzMiAzNCAzNiAzOCA0MCAuLi4gdn0gKilcbmxldCBwYXJlbnRfaW5kZXggfmNoaWxkX2luZGV4ID0gKGNoaWxkX2luZGV4IC0gMSkgLyAyXG5sZXQgbGVmdF9jaGlsZF9pbmRleCB+cGFyZW50X2luZGV4ID0gKHBhcmVudF9pbmRleCAqIDIpICsgMVxubGV0IHJpZ2h0X2NoaWxkX2luZGV4IH5sZWZ0X2NoaWxkX2luZGV4ID0gbGVmdF9jaGlsZF9pbmRleCArIDFcblxuKCogVGhlIGZpcnN0IFtudW1fbGVhdmVzLTFdIGVsZW1lbnRzIGFyZSBpbnRlcm5hbCBub2RlcyBvZiB0aGUgdHJlZS4gIFRoZSBuZXh0XG4gICBbbnVtX2xlYXZlc10gZWxlbWVudHMgYXJlIHRoZSBsZWF2ZXMuICopXG5sZXQgbnVtX2JyYW5jaGVzIHQgPSB0Lm51bV9sZWF2ZXMgLSAxXG5sZXQgaW5kZXhfaXNfbGVhZiB0IGkgPSBpID49IG51bV9icmFuY2hlcyB0XG5cbigqIFRoZSB0cmVlIGlzIGNvbXBsZXRlLCBidXQgbm90IG5lY2Vzc2FyaWx5IHBlcmZlY3QsIHNvIHdlIHBlcmZvcm0gc29tZSByb3RhdGlvbiBvZiB0aGVcbiAgIGxlYXZlcyB0byBlbnN1cmUgdGhhdCBvdXIgcmVkdWN0aW9ucyBwcmVzZXJ2ZSBvcmRlcmluZy4gKilcbmxldCBsZWFmX2luZGV4IHQgaSA9XG4gICgqIFRoZSB0cmVlIGxheW91dCBpcyBsZXZlbCBvcmRlci4gIEFueSBsZWF2ZXMgaW4gdGhlIHNlY29uZCB0byBsYXN0IGxldmVsIG5lZWQgdG8gb2NjdXJcbiAgICAgaW4gdGhlIGFycmF5IGJlZm9yZSB0aGUgbGVhdmVzIGluIHRoZSBib3R0b20gbGV2ZWwuICopXG4gIGxldCByb3RhdGVkX2luZGV4ID1cbiAgICBsZXQgb2Zmc2V0X2Zyb21fc3RhcnRfb2ZfbGVhdmVzX2luX2FycmF5ID0gaSArIHQubnVtX2xlYXZlc19ub3RfaW5fYm90dG9tX2xldmVsIGluXG4gICAgaWYgb2Zmc2V0X2Zyb21fc3RhcnRfb2ZfbGVhdmVzX2luX2FycmF5IDwgdC5udW1fbGVhdmVzXG4gICAgdGhlbiBvZmZzZXRfZnJvbV9zdGFydF9vZl9sZWF2ZXNfaW5fYXJyYXlcbiAgICBlbHNlIG9mZnNldF9mcm9tX3N0YXJ0X29mX2xlYXZlc19pbl9hcnJheSAtIHQubnVtX2xlYXZlc1xuICBpblxuICAoKiBUaGUgbGVhdmVzIG9jY3VyIGFmdGVyIHRoZSBicmFuY2hlcyBpbiB0aGUgYXJyYXkuICopXG4gIHJvdGF0ZWRfaW5kZXggKyBudW1fYnJhbmNoZXMgdFxuOztcblxubGV0IGdldF9sZWFmIHQgaSA9IE9wdGlvbl9hcnJheS5nZXQgdC5kYXRhIChsZWFmX2luZGV4IHQgaSlcbmxldCB0b19saXN0IHQgPSBMaXN0LmluaXQgKGxlbmd0aCB0KSB+ZjooZnVuIGkgLT4gZ2V0X2xlYWYgdCBpKVxubGV0IHNleHBfb2ZfdCBzZXhwX29mX2EgdCA9IFslc2V4cCAodG9fbGlzdCB0IDogYSBvcHRpb24gbGlzdCldXG5cbmxldCBpbnZhcmlhbnQgaW52YXJpYW50X2EgdCA9XG4gIGxldCBkYXRhID0gdC5kYXRhIGluXG4gIGZvciBpID0gMCB0byBPcHRpb25fYXJyYXkubGVuZ3RoIGRhdGEgLSAxIGRvXG4gICAgbWF0Y2ggT3B0aW9uX2FycmF5LmdldCBkYXRhIGkgd2l0aFxuICAgIHwgTm9uZSAtPiAoKVxuICAgIHwgU29tZSBhIC0+IGludmFyaWFudF9hIGFcbiAgZG9uZTtcbiAgZm9yIGkgPSAwIHRvIG51bV9icmFuY2hlcyB0IC0gMSBkb1xuICAgIGxldCBsZWZ0ID0gbGVmdF9jaGlsZF9pbmRleCB+cGFyZW50X2luZGV4OmkgaW5cbiAgICBsZXQgcmlnaHQgPSByaWdodF9jaGlsZF9pbmRleCB+bGVmdF9jaGlsZF9pbmRleDpsZWZ0IGluXG4gICAgbGV0IGxlZnRfaXNfbm9uZSA9IE9wdGlvbl9hcnJheS5pc19ub25lIGRhdGEgbGVmdCBpblxuICAgIGxldCByaWdodF9pc19ub25lID0gT3B0aW9uX2FycmF5LmlzX25vbmUgZGF0YSByaWdodCBpblxuICAgIGlmIE9wdGlvbl9hcnJheS5pc19zb21lIGRhdGEgaVxuICAgIHRoZW4gYXNzZXJ0IChub3QgKGxlZnRfaXNfbm9uZSB8fCByaWdodF9pc19ub25lKSlcbiAgICBlbHNlXG4gICAgICBhc3NlcnQgKFxuICAgICAgICBpbmRleF9pc19sZWFmIHQgbGVmdCB8fCBpbmRleF9pc19sZWFmIHQgcmlnaHQgfHwgbGVmdF9pc19ub25lIHx8IHJpZ2h0X2lzX25vbmUpXG4gIGRvbmVcbjs7XG5cbmxldCBjcmVhdGVfZXhuID8oc2V4cF9vZl9hID0gWyVzZXhwX29mOiBfXSkgKCkgfmxlbjpudW1fbGVhdmVzIH5yZWR1Y2UgPVxuICBpZiBudW1fbGVhdmVzIDwgMVxuICB0aGVuXG4gICAgcmFpc2Vfc1xuICAgICAgWyVtZXNzYWdlIFwibm9uLXBvc2l0aXZlIG51bWJlciBvZiBsZWF2ZXMgaW4gYmFsYW5jZWQgcmVkdWNlclwiIChudW1fbGVhdmVzIDogaW50KV07XG4gIGxldCBudW1fYnJhbmNoZXMgPSBudW1fbGVhdmVzIC0gMSBpblxuICBsZXQgbnVtX2xlYXZlc19ub3RfaW5fYm90dG9tX2xldmVsID0gSW50LmNlaWxfcG93MiBudW1fbGVhdmVzIC0gbnVtX2xlYXZlcyBpblxuICBsZXQgZGF0YSA9IE9wdGlvbl9hcnJheS5jcmVhdGUgfmxlbjoobnVtX2JyYW5jaGVzICsgbnVtX2xlYXZlcykgaW5cbiAgeyBkYXRhOyBudW1fbGVhdmVzOyBudW1fbGVhdmVzX25vdF9pbl9ib3R0b21fbGV2ZWw7IHJlZHVjZTsgc2V4cF9vZl9hIH1cbjs7XG5cbmxldCB2YWxpZGF0ZV9pbmRleCB0IGkgPVxuICBpZiBpIDwgMFxuICB0aGVuXG4gICAgcmFpc2Vfc1xuICAgICAgWyVtZXNzYWdlIFwiYXR0ZW1wdCB0byBhY2Nlc3MgbmVnYXRpdmUgaW5kZXggaW4gYmFsYW5jZWQgcmVkdWNlclwiIH5pbmRleDooaSA6IGludCldO1xuICBsZXQgbGVuZ3RoID0gdC5udW1fbGVhdmVzIGluXG4gIGlmIGkgPj0gbGVuZ3RoXG4gIHRoZW5cbiAgICByYWlzZV9zXG4gICAgICBbJW1lc3NhZ2VcbiAgICAgICAgXCJhdHRlbXB0IHRvIGFjY2VzcyBvdXQgb2YgYm91bmRzIGluZGV4IGluIGJhbGFuY2VkIHJlZHVjZXJcIlxuICAgICAgICAgIH5pbmRleDooaSA6IGludClcbiAgICAgICAgICAobGVuZ3RoIDogaW50KV1cbjs7XG5cbmxldCBzZXRfZXhuIHQgaSBhID1cbiAgdmFsaWRhdGVfaW5kZXggdCBpO1xuICBsZXQgZGF0YSA9IHQuZGF0YSBpblxuICBsZXQgaSA9IHJlZiAobGVhZl9pbmRleCB0IGkpIGluXG4gIE9wdGlvbl9hcnJheS5zZXRfc29tZSBkYXRhICFpIGE7XG4gIHdoaWxlICFpIDw+IDAgZG9cbiAgICBsZXQgcGFyZW50ID0gcGFyZW50X2luZGV4IH5jaGlsZF9pbmRleDohaSBpblxuICAgIGlmIE9wdGlvbl9hcnJheS5pc19ub25lIGRhdGEgcGFyZW50XG4gICAgdGhlbiBpIDo9IDBcbiAgICBlbHNlIChcbiAgICAgIE9wdGlvbl9hcnJheS51bnNhZmVfc2V0X25vbmUgZGF0YSBwYXJlbnQ7XG4gICAgICBpIDo9IHBhcmVudClcbiAgZG9uZVxuOztcblxubGV0IGdldF9leG4gdCBpID1cbiAgdmFsaWRhdGVfaW5kZXggdCBpO1xuICBPcHRpb25fYXJyYXkuZ2V0X3NvbWVfZXhuIHQuZGF0YSAobGVhZl9pbmRleCB0IGkpXG47O1xuXG5sZXQgcmVjIGNvbXB1dGVfZXhuIHQgaSA9XG4gIGlmIE9wdGlvbl9hcnJheS5pc19zb21lIHQuZGF0YSBpXG4gIHRoZW4gT3B0aW9uX2FycmF5LnVuc2FmZV9nZXRfc29tZV9leG4gdC5kYXRhIGlcbiAgZWxzZSAoXG4gICAgbGV0IGxlZnQgPSBsZWZ0X2NoaWxkX2luZGV4IH5wYXJlbnRfaW5kZXg6aSBpblxuICAgIGxldCByaWdodCA9IHJpZ2h0X2NoaWxkX2luZGV4IH5sZWZ0X2NoaWxkX2luZGV4OmxlZnQgaW5cbiAgICBpZiBsZWZ0ID49IE9wdGlvbl9hcnJheS5sZW5ndGggdC5kYXRhXG4gICAgdGhlbiAoXG4gICAgICAoKiBJZiB3ZSBnZXQgaGVyZSwgdGhlIHBhcmVudCB3YXMgYW4gdW5zZXQgbGVhZi4gKilcbiAgICAgIGxldCBzZXhwX29mX2EgPSB0LnNleHBfb2ZfYSBpblxuICAgICAgcmFpc2Vfc1xuICAgICAgICBbJW1lc3NhZ2VcbiAgICAgICAgICBcImF0dGVtcHQgdG8gY29tcHV0ZSBiYWxhbmNlZCByZWR1Y2VyIHdpdGggdW5zZXQgZWxlbWVudHNcIlxuICAgICAgICAgICAgfmJhbGFuY2VkX3JlZHVjZXI6KHQgOiBhIHQpXSk7XG4gICAgbGV0IGEgPSB0LnJlZHVjZSAoY29tcHV0ZV9leG4gdCBsZWZ0KSAoY29tcHV0ZV9leG4gdCByaWdodCkgaW5cbiAgICBPcHRpb25fYXJyYXkudW5zYWZlX3NldF9zb21lIHQuZGF0YSBpIGE7XG4gICAgYSlcbjs7XG5cbmxldCBjb21wdXRlX2V4biB0ID0gY29tcHV0ZV9leG4gdCAwXG4iXX0=
